<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, onSnapshot, collection, query, addDoc, serverTimestamp, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Configuração fixa do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyBPEKtr1KM96N3MQi1IKCOTIjVltQ3t_8s",
        authDomain: "sistema-de-registro-de-faltas.firebaseapp.com",
        projectId: "sistema-de-registro-de-faltas",
        storageBucket: "sistema-de-registro-de-faltas.firebasestorage.app",
        messagingSenderId: "959428862131",
        appId: "1:959428862131:web:1435601cc3e46b5d0b10c6",
        measurementId: "G-6GB6ZJDDYB"
    };

    const initialAuthToken = null; // não usado no seu caso
    const appId = 'default-app-id';
    
    let app = null;
    let auth = null;
    let db = null;
    
    const ADMIN_PASSWORD = "335176++";
    const PUBLIC_COLLECTION_PATH = `artifacts/${appId}/public/data/absences`;

    if (Object.keys(firebaseConfig).length > 0) {
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            
            async function authenticate() {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                    console.log("Autenticado com sucesso.");
                } catch (error) {
                    console.error("Erro na autenticação:", error);
                    document.getElementById('error-message').textContent = "Erro de autenticação. O sistema pode não funcionar.";
                    document.getElementById('error-message').style.display = 'block';
                }
            }

            authenticate().then(() => {
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log("Usuário autenticado. ID:", user.uid);
                        console.log("ID da Aplicação:", appId);
                        startDataListener();
                    } else {
                        console.log("Usuário não autenticado.");
                    }
                });
            });

        } catch (e) {
            console.error("Erro na inicialização do Firebase:", e);
            document.getElementById('error-message').textContent = "Erro ao iniciar o Firebase. Verifique sua conexão ou configuração.";
            document.getElementById('error-message').style.display = 'block';
        }
    } else {
        document.getElementById('error-message').textContent = "Erro: A configuração do Firebase não foi definida. Por favor, adicione seu objeto de configuração ao código.";
        document.getElementById('error-message').style.display = 'block';
        console.error("Firebase não inicializado: firebaseConfig está vazio.");
    }

    // O RESTANTE DO SEU SCRIPT ORIGINAL VEM AQUI (funções de listener, updateUI, etc.)
</script>
